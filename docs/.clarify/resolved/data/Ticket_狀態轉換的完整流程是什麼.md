# 釐清問題

票券從建立到使用結束的完整狀態轉換流程是什麼？所有可能的狀態轉換路徑是什麼？

# 定位

ERM：Ticket.status 屬性（值為：待驗證、已入場、已過期、已取消）

# 多選題

| 選項 | 描述 |
|--------|-------------|
| A | 線性流程：待付款 → 待驗證 → 已入場（或已過期、已取消） |
| B | 複雜流程：包含多個中間狀態與回溯路徑 |
| Short | 具體狀態轉換圖 |

# 影響範圍

- Ticket 實體的生命週期
- 訂票功能的支付與狀態管理
- 驗票功能的狀態檢查
- 退款流程（已取消何時觸發）

# 優先級

High

---

**說明**：規格提到的票券狀態有「待驗證、已入場、已過期、已取消」，但未明確定義狀態轉換規則、轉換觸發條件、以及是否允許狀態回溯。

---
# 解決記錄

- **回答**：A - 確認當前四態設計
- **更新的規格檔**：無需修改（當前設計已符合需求）
- **變更內容**：
  - 決策：確認票券四態設計 - 待支付 → 未使用 → 已使用 / 已過期
  - 狀態轉換規則：
    - **待支付**：確認票券時進入，座位立即鎖定
    - **未使用**：支付成功後轉為此狀態
    - **已使用**：掃 QR code 驗票成功後轉為此狀態
    - **已過期**：3 分鐘未付款或電影結束時轉為此狀態，座位自動釋放
  - 座位鎖定規則：待支付/未使用/已使用 = 鎖定；已過期 = 釋放
  - 當前 erm.dbml 中 Ticket.status 的定義已完整描述此四態設計，符合此決策
