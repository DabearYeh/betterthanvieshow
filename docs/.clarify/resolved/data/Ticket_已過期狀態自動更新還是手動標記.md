# Ticket_已過期狀態自動更新還是手動標記

票券過期後,是自動即時更新為「已過期」,還是驗票時發現並拒絕？

# 定義

ERM：Ticket.status = 已過期的觸發時機
Feature：驗票功能 Rule: 必須檢查票券是否過期

# 多選項

| 選項 | 描述 |
|--------|-------------|
| A | 主動：系統定時或即時檢查場次結束時間,自動更新票券狀態 |
| B | 被動：驗票時檢查場次時間是否已過期,拒絕驗票但不更新狀態 |
| C | 混合：驗票時發現過期才更新狀態並拒絕驗票 |
| Short | 其他邏輯 |

# 影響範圍

- Ticket 狀態管理的設計
- 驗票功能的實作邏輯
- 系統效能與定時任務設計

# 優先級

Medium

---

**說明**：「已過期」是一個特殊的狀態,需要明確定義如何被標記,以便於查詢與統計。

---

# 解決記錄

- **決議**：B  被動檢查：驗票時才檢查場次時間,若已過期則拒絕驗票但不更新狀態
- **更新規格檔案**：spec/features/驗票.feature
- **變更內容**：明確驗票理由為「被動檢查」所以
  - 驗票時檢查票券狀態與場次是否已結束
  - 若場次已結束（場次時間 > 當前結束時間）,則拒絕驗票,回傳「票券已過期」
  - 不修改 Ticket.status（保持為「未使用」狀態）
  - 即時計算,無需定時更新

補充說明:
- 簡化系統設計,無需定時更新狀態
- Ticket.status = 「已過期」狀態可能不會被使用（或僅作為查詢時的「虛擬狀態」）
- 可在驗票日誌（TicketValidateLog）記錄拒絕原因（例如「票券已過期」）
