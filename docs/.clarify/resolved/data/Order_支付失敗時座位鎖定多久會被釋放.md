# 釐清問題

訂單支付失敗後，座位應鎖定多久？如果使用者未在期限內重新付款，座位是否自動釋放？

# 定位

ERM：Order, Ticket, Seat 之間的關係
Feature：訂票 Rule: 支付失敗時座位鎖定並允許重新付款

# 多選項

| 選項 | 描述 |
|--------|-------------|
| A | 座位鎖定 3 分鐘，逾時自動釋放，期間使用者可重新付款 |
| B | 座位鎖定 15 分鐘，期間使用者可重新付款；逾時自動釋放座位 |
| C | 座位鎖定 30 分鐘，期間使用者可重新付款；逾時自動釋放座位 |
| D | 座位鎖定 1 小時，期間使用者可重新付款；逾時自動釋放座位 |
| Short | 其他時間長度 |

# 影響範圍

- 訂票系統與座位預留邏輯
- 支付失敗流程設計
- 座位使用率管理邏輯
- 訂單清理任務（自動釋放）

# 優先級

High

---

**說明**：若座位鎖定時間過長可能導致訂單佔用座位；若時間過短，使用者驗證不佳。需要平衡定義合適的鎖定時間。

---

# 解決記錄

- **回答**：A — 座位鎖定 3 分鐘後自動釋放
- **邏輯**：與未付款訂單保持一致，支付失敗後座位在 3 分鐘內被保留，期間使用者可重新付款；逾時自動釋放
- **更新的規格檔**：spec/features/訂票.feature、spec/erm.dbml Order 和 Ticket

**實施細節**：
- 訂單建立時：Order.status 設為「未付款」，Ticket.status 設為「待支付」，座位被鎖定
- 支付失敗時：邏輯同未付款訂單，座位鎖定 3 分鐘
- Ticket.status 決策：待支付/未使用/已使用 = 座位鎖定；已過期 = 座位釋放
